import createFetchClient from 'openapi-fetch';
import createClient from 'openapi-react-query';
import { QueryCache, QueryClient } from '@tanstack/react-query';
import type { paths } from './types/api'; // generated by openapi-typescript (see README for details)
import env from './env';
import notifySlack from './util/slack';

const BACKEND_LOCATIONS_URL = env.VITE_API_URL === 'local' ? '/' : `${env.VITE_API_URL}`;

const fetchClient = createFetchClient<paths>({
    baseUrl: 'https://dining-api-staging.up.railway.app', // force staging url for now so that when we push this code to prod we'll have time to migrate the backend to prod without disturbing uptime
});
export const queryClient = new QueryClient({
    defaultOptions: { queries: { staleTime: 120 * 1000 } },
    queryCache: new QueryCache({
        onError(error, query) {
            notifySlack(`<!channel> API ERROR! ${error}: ${query.queryKey.join('|')}`);
        },
    }),
});

export const $api = createClient(fetchClient);
